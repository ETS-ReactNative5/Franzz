{"ast":null,"code":"var _jsxFileName = \"/home/hei/Documents/finals/JEK/client/src/components/Home/Home.js\";\nimport React, { useEffect } from 'react';\nimport { BrowserRouter as Router, Switch, Route, Redirect } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport { serverURL } from '../../utils/config';\nimport channelService from '../../service/channelService';\nimport mapService from '../../service/mapService';\nimport NewChannelModal from './ChannelList/NewChannelModal';\nimport ChannelList from './ChannelList/ChannelList';\nimport Channel from './Channel/Channel';\nimport PopupToast from './PopUpToast';\nimport { useYoutube } from '../../hooks/useYoutube';\nimport { useChat } from '../../hooks/useChat';\nimport './homeStyling.css';\nimport '../../styles.css';\nlet socket;\n\nconst Home = ({\n  state,\n  setState\n}) => {\n  const {\n    emitSendMessage,\n    emitJoinChannel,\n    emitCreateChannel\n  } = useChat(state, setState, socket);\n  const {\n    changeVideoState,\n    syncVideo\n  } = useYoutube(state, setState, socket);\n\n  const sendLine = line => {\n    const lineObj = {\n      line,\n      channel: state.currentChannel,\n      user: state.currentUser\n    };\n    setState(prev => ({ ...prev,\n      lines: { ...prev.lines,\n        [state.currentChannel]: { ...prev.lines[state.currentChannel],\n          [state.currentUser]: {\n            user: state.currentUser,\n            line\n          }\n        }\n      }\n    }));\n    socket.emit('draw', lineObj);\n  };\n\n  const updateLocation = location => {\n    const locationObj = {\n      location,\n      authorization: state.authorization\n    };\n    socket.emit('update location', locationObj, locations => {\n      setState(prev => ({ ...prev,\n        locations,\n        center: location\n      }));\n    });\n  };\n\n  const getLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.watchPosition(() => {\n        mapService.getLocation(updateLocation);\n      });\n    }\n  };\n\n  const channels = Object.keys(state.channelStates);\n  const channelIdNamePair = channels.map(id => ({\n    id,\n    name: state.channelStates[id].name\n  }));\n\n  const selectCurrentChannel = channel => {\n    setState(prev => ({ ...prev,\n      currentChannel: channel\n    }));\n  };\n\n  const toggleForm = s => {\n    setState(prev => ({ ...prev,\n      newChannelForm: s\n    }));\n  };\n\n  const channelItems = channels.map(id => {\n    const {\n      name,\n      messages,\n      users\n    } = state.channelStates[id];\n    return React.createElement(Route, {\n      path: `/channel/${id}`,\n      key: `${id}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, React.createElement(Channel, {\n      channel: id,\n      name: name,\n      messages: messages,\n      userStatus: state.users[id],\n      userList: users,\n      emitSendMessage: emitSendMessage,\n      locations: state.locations[id],\n      center: state.center,\n      currentUser: state.currentUser,\n      videoStates: state.videoStates,\n      changeVideoState: changeVideoState,\n      syncVideo: syncVideo,\n      sendLine: sendLine,\n      lines: state.lines[id],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }));\n  }); // handle initial state\n\n  useEffect(() => {\n    // grab all channel data, messages\n    if (state.authorization) {\n      channelService.getUserData().then(({\n        channelData\n      }) => {\n        const channelStates = channelData.reduce((obj, ele) => {\n          if (!obj[ele.data.channel]) {\n            // eslint-disable-next-line no-param-reassign\n            obj[ele.data.channel] = {\n              users: ele.data.users,\n              name: ele.data.name,\n              channel: ele.data.channel,\n              messages: ele.messages\n            };\n          }\n\n          return obj;\n        }, {});\n        const videoStates = channelData.reduce((obj, ele) => {\n          // eslint-disable-next-line no-param-reassign\n          obj[ele.data.channel] = {\n            url: '5mGuCdlCcNM',\n            played: false,\n            paused: true\n          };\n          return obj;\n        }, {});\n        setState(prev => ({ ...prev,\n          channelStates,\n          videoStates,\n          currentChannel: Object.keys(channelStates)[0]\n        }));\n      });\n    }\n\n    socket = io(`${serverURL}/`);\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', data => {\n        console.log(data);\n      });\n      socket.emit('join channels', {\n        authorization: state.authorization\n      }, data => {\n        console.log(data);\n      });\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    if (!state.currentChannelLoaded) {\n      setState(prev => ({ ...prev,\n        currentChannelLoaded: true\n      }));\n    } else {\n      setState(prev => ({ ...prev,\n        loaded: true\n      }));\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [state.currentChannel]);\n  useEffect(() => {\n    mapService.getLocation(updateLocation);\n    getLocation();\n    socket.on('new message', data => {\n      const {\n        channelID,\n        newMessageObj\n      } = data;\n\n      if (channelID && newMessageObj) {\n        setState(prev => ({ ...prev,\n          channelStates: { ...prev.channelStates,\n            [channelID]: { ...prev.channelStates[channelID],\n              messages: prev.channelStates[channelID].messages.concat(newMessageObj)\n            }\n          }\n        }));\n      }\n    });\n    socket.on('user status', ({\n      userStatus\n    }) => {\n      const {\n        channel,\n        users\n      } = userStatus;\n      console.log(users, channel);\n      setState(prev => ({ ...prev,\n        users: { ...prev.users,\n          [channel]: users\n        }\n      }));\n    });\n    socket.on('update location', updatedLocations => {\n      if (updatedLocations) {\n        setState(prev => ({ ...prev,\n          locations: { ...prev.locations,\n            ...updatedLocations\n          }\n        }));\n      }\n    });\n    socket.on('new video state', ({\n      url,\n      paused,\n      played,\n      channel\n    }) => {\n      if (url) {\n        setState(prev => ({ ...prev,\n          videoStates: { ...prev.videoStates,\n            [channel]: {\n              url,\n              paused,\n              played\n            }\n          }\n        }));\n      }\n    });\n    socket.on('new time stamp', ({\n      time,\n      channel\n    }) => {\n      setState(prev => ({ ...prev,\n        videoStates: { ...prev.videoStates,\n          [channel]: { ...prev.videoStates[channel],\n            timeStamp: time\n          }\n        }\n      }));\n    });\n    socket.on('draw', ({\n      user,\n      channel,\n      line\n    }) => {\n      setState(prev => ({ ...prev,\n        lines: { ...prev.lines,\n          [channel]: { ...prev.lines[channel],\n            [user]: {\n              user,\n              line\n            }\n          }\n        }\n      }));\n    });\n    return () => {\n      socket.off();\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return React.createElement(\"div\", {\n    id: \"main-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282\n    },\n    __self: this\n  }, React.createElement(Router, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283\n    },\n    __self: this\n  }, React.createElement(ChannelList, {\n    selectCurrentChannel: selectCurrentChannel,\n    channelIdNamePair: channelIdNamePair,\n    emitJoinChannel: emitJoinChannel,\n    emitCreateChannel: emitCreateChannel,\n    toggleForm: toggleForm,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284\n    },\n    __self: this\n  }), React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291\n    },\n    __self: this\n  }, channelItems), state.loaded && !state.currentChannel && React.createElement(NewChannelModal, {\n    emitCreateChannel: emitCreateChannel,\n    emitJoinChannel: emitJoinChannel,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295\n    },\n    __self: this\n  }), React.createElement(PopupToast, {\n    show: state.newChannelForm,\n    toggleForm: toggleForm,\n    emitCreateChannel: emitCreateChannel,\n    emitJoinChannel: emitJoinChannel,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300\n    },\n    __self: this\n  }), React.createElement(Redirect, {\n    exact: true,\n    from: \"/home\",\n    to: state.currentChannel ? `/channel/${state.currentChannel}` : '/home',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306\n    },\n    __self: this\n  })));\n};\n\nexport default Home;","map":{"version":3,"sources":["/home/hei/Documents/finals/JEK/client/src/components/Home/Home.js"],"names":["React","useEffect","BrowserRouter","Router","Switch","Route","Redirect","io","serverURL","channelService","mapService","NewChannelModal","ChannelList","Channel","PopupToast","useYoutube","useChat","socket","Home","state","setState","emitSendMessage","emitJoinChannel","emitCreateChannel","changeVideoState","syncVideo","sendLine","line","lineObj","channel","currentChannel","user","currentUser","prev","lines","emit","updateLocation","location","locationObj","authorization","locations","center","getLocation","navigator","geolocation","watchPosition","channels","Object","keys","channelStates","channelIdNamePair","map","id","name","selectCurrentChannel","toggleForm","s","newChannelForm","channelItems","messages","users","videoStates","getUserData","then","channelData","reduce","obj","ele","data","url","played","paused","on","console","log","currentChannelLoaded","loaded","channelID","newMessageObj","concat","userStatus","updatedLocations","time","timeStamp","off"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n} from 'react-router-dom';\nimport io from 'socket.io-client';\nimport { serverURL } from '../../utils/config';\n\nimport channelService from '../../service/channelService';\nimport mapService from '../../service/mapService';\n\nimport NewChannelModal from './ChannelList/NewChannelModal';\nimport ChannelList from './ChannelList/ChannelList';\nimport Channel from './Channel/Channel';\n\nimport PopupToast from './PopUpToast';\n\nimport { useYoutube } from '../../hooks/useYoutube';\nimport { useChat } from '../../hooks/useChat';\n\nimport './homeStyling.css';\nimport '../../styles.css';\n\nlet socket;\n\nconst Home = ({ state, setState }) => {\n  const {\n    emitSendMessage,\n    emitJoinChannel,\n    emitCreateChannel,\n  } = useChat(state, setState, socket);\n\n  const {\n    changeVideoState,\n    syncVideo,\n  } = useYoutube(state, setState, socket);\n\n  const sendLine = (line) => {\n    const lineObj = {\n      line,\n      channel: state.currentChannel,\n      user: state.currentUser,\n    };\n    setState((prev) => ({\n      ...prev,\n      lines: {\n        ...prev.lines,\n        [state.currentChannel]: {\n          ...prev.lines[state.currentChannel],\n          [state.currentUser]: {\n            user: state.currentUser,\n            line,\n          },\n        },\n      },\n    }));\n    socket.emit('draw', lineObj);\n  };\n\n  const updateLocation = (location) => {\n    const locationObj = {\n      location,\n      authorization: state.authorization,\n    };\n    socket.emit('update location', locationObj, (locations) => {\n      setState((prev) => ({\n        ...prev,\n        locations,\n        center: location,\n      }));\n    });\n  };\n\n  const getLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.watchPosition(() => {\n        mapService.getLocation(updateLocation);\n      });\n    }\n  };\n\n  const channels = Object.keys(state.channelStates);\n  const channelIdNamePair = channels.map((id) => ({ id, name: state.channelStates[id].name }));\n\n  const selectCurrentChannel = (channel) => {\n    setState((prev) => ({ ...prev, currentChannel: channel }));\n  };\n\n  const toggleForm = (s) => {\n    setState((prev) => ({ ...prev, newChannelForm: s }));\n  };\n\n  const channelItems = channels.map((id) => {\n    const { name, messages, users } = state.channelStates[id];\n    return (\n      <Route\n        path={`/channel/${id}`}\n        key={`${id}`}\n      >\n        <Channel\n          channel={id}\n          name={name}\n          messages={messages}\n          userStatus={state.users[id]}\n          userList={users}\n          emitSendMessage={emitSendMessage}\n          locations={state.locations[id]}\n          center={state.center}\n          currentUser={state.currentUser}\n          videoStates={state.videoStates}\n          changeVideoState={changeVideoState}\n          syncVideo={syncVideo}\n          sendLine={sendLine}\n          lines={state.lines[id]}\n        />\n      </Route>\n    );\n  });\n\n  // handle initial state\n  useEffect(() => {\n    // grab all channel data, messages\n    if (state.authorization) {\n      channelService\n        .getUserData()\n        .then(({ channelData }) => {\n          const channelStates = channelData.reduce((obj, ele) => {\n            if (!obj[ele.data.channel]) {\n              // eslint-disable-next-line no-param-reassign\n              obj[ele.data.channel] = {\n                users: ele.data.users,\n                name: ele.data.name,\n                channel: ele.data.channel,\n                messages: ele.messages,\n              };\n            }\n            return obj;\n          }, {});\n          const videoStates = channelData.reduce((obj, ele) => {\n            // eslint-disable-next-line no-param-reassign\n            obj[ele.data.channel] = {\n              url: '5mGuCdlCcNM',\n              played: false,\n              paused: true,\n            };\n            return obj;\n          }, {});\n          setState((prev) => ({\n            ...prev,\n            channelStates,\n            videoStates,\n            currentChannel: Object.keys(channelStates)[0],\n          }));\n        });\n    }\n    socket = io(`${serverURL}/`);\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', (data) => {\n        console.log(data);\n      });\n      socket.emit('join channels', { authorization: state.authorization }, (data) => {\n        console.log(data);\n      });\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!state.currentChannelLoaded) {\n      setState((prev) => ({ ...prev, currentChannelLoaded: true }));\n    } else {\n      setState((prev) => ({ ...prev, loaded: true }));\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.currentChannel]);\n\n  useEffect(() => {\n    mapService.getLocation(updateLocation);\n    getLocation();\n\n    socket.on('new message', (data) => {\n      const { channelID, newMessageObj } = data;\n      if (channelID && newMessageObj) {\n        setState((prev) => (\n          {\n            ...prev,\n            channelStates: {\n              ...prev.channelStates,\n              [channelID]: {\n                ...prev.channelStates[channelID],\n                messages: prev.channelStates[channelID].messages.concat(newMessageObj),\n              },\n            },\n          }));\n      }\n    });\n\n    socket.on('user status', ({ userStatus }) => {\n      const { channel, users } = userStatus;\n      console.log(users, channel)\n      setState((prev) => ({\n        ...prev,\n        users: {\n          ...prev.users,\n          [channel]: users,\n        },\n      }));\n    });\n\n    socket.on('update location', (updatedLocations) => {\n      if (updatedLocations) {\n        setState((prev) => ({\n          ...prev,\n          locations: {\n            ...prev.locations,\n            ...updatedLocations,\n          },\n        }));\n      }\n    });\n\n    socket.on('new video state', ({\n      url, paused, played, channel,\n    }) => {\n      if (url) {\n        setState((prev) => (\n          {\n            ...prev,\n            videoStates: {\n              ...prev.videoStates,\n              [channel]: {\n                url,\n                paused,\n                played,\n              },\n            },\n          }\n        ));\n      }\n    });\n\n    socket.on('new time stamp', ({\n      time, channel,\n    }) => {\n      setState((prev) => (\n        {\n          ...prev,\n          videoStates: {\n            ...prev.videoStates,\n            [channel]: { ...prev.videoStates[channel], timeStamp: time },\n          },\n        }\n      ));\n    });\n\n    socket.on('draw', ({ user, channel, line }) => {\n      setState((prev) => ({\n        ...prev,\n        lines: {\n          ...prev.lines,\n          [channel]: {\n            ...prev.lines[channel],\n            [user]: {\n              user,\n              line,\n            },\n          },\n        },\n      }));\n    });\n\n    return () => {\n      socket.off();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div id=\"main-container\">\n      <Router>\n        <ChannelList\n          selectCurrentChannel={selectCurrentChannel}\n          channelIdNamePair={channelIdNamePair}\n          emitJoinChannel={emitJoinChannel}\n          emitCreateChannel={emitCreateChannel}\n          toggleForm={toggleForm}\n        />\n        <Switch>\n          {channelItems}\n        </Switch>\n        {state.loaded && !state.currentChannel && (\n        <NewChannelModal\n          emitCreateChannel={emitCreateChannel}\n          emitJoinChannel={emitJoinChannel}\n        />\n        )}\n        <PopupToast\n          show={state.newChannelForm}\n          toggleForm={toggleForm}\n          emitCreateChannel={emitCreateChannel}\n          emitJoinChannel={emitJoinChannel}\n        />\n        <Redirect exact from=\"/home\" to={state.currentChannel ? `/channel/${state.currentChannel}` : '/home'} />\n      </Router>\n    </div>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}