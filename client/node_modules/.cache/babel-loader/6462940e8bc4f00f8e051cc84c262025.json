{"ast":null,"code":"import _defineProperty from\"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useEffect}from'react';import{BrowserRouter as Router,Switch,Route,Redirect}from'react-router-dom';import io from'socket.io-client';import{serverURL}from'../../utils/config';import channelService from'../../service/channelService';import mapService from'../../service/mapService';import NewChannelModal from'./ChannelList/NewChannelModal';import ChannelList from'./ChannelList/ChannelList';import Channel from'./Channel/Channel';import PopupToast from'./PopUpToast';import{useYoutube}from'../../hooks/useYoutube';import{useChat}from'../../hooks/useChat';import'./homeStyling.css';import'../../styles.css';var socket;var Home=function Home(_ref){var state=_ref.state,setState=_ref.setState;var _useChat=useChat(state,setState,socket),emitSendMessage=_useChat.emitSendMessage,emitJoinChannel=_useChat.emitJoinChannel,emitCreateChannel=_useChat.emitCreateChannel;var _useYoutube=useYoutube(state,setState,socket),changeVideoState=_useYoutube.changeVideoState,syncVideo=_useYoutube.syncVideo;var sendLine=function sendLine(line){var lineObj={line:line,channel:state.currentChannel,user:state.currentUser};setState(function(prev){return _objectSpread({},prev,{lines:_objectSpread({},prev.lines,_defineProperty({},state.currentChannel,_objectSpread({},prev.lines[state.currentChannel],_defineProperty({},state.currentUser,{user:state.currentUser,line:line}))))});});socket.emit('draw',lineObj);};var updateLocation=function updateLocation(location){var locationObj={location:location,authorization:state.authorization};socket.emit('update location',locationObj,function(locations){setState(function(prev){return _objectSpread({},prev,{locations:locations,center:location});});});};var getLocation=function getLocation(){if(navigator.geolocation){navigator.geolocation.watchPosition(function(){mapService.getLocation(updateLocation);});}};var channels=Object.keys(state.channelStates);var channelIdNamePair=channels.map(function(id){return{id:id,name:state.channelStates[id].name};});var selectCurrentChannel=function selectCurrentChannel(channel){setState(function(prev){return _objectSpread({},prev,{currentChannel:channel});});};var toggleForm=function toggleForm(s){setState(function(prev){return _objectSpread({},prev,{newChannelForm:s});});};var channelItems=channels.map(function(id){var _state$channelStates$=state.channelStates[id],name=_state$channelStates$.name,messages=_state$channelStates$.messages,users=_state$channelStates$.users;return React.createElement(Route,{path:\"/channel/\".concat(id),key:\"\".concat(id)},React.createElement(Channel,{channel:id,name:name,messages:messages,userStatus:state.users[id],userList:users,emitSendMessage:emitSendMessage,locations:state.locations[id],center:state.center,currentUser:state.currentUser,videoStates:state.videoStates,changeVideoState:changeVideoState,syncVideo:syncVideo,sendLine:sendLine,lines:state.lines[id]}));});// handle initial state\nuseEffect(function(){// grab all channel data, messages\nif(state.authorization){channelService.getUserData().then(function(_ref2){var channelData=_ref2.channelData;var channelStates=channelData.reduce(function(obj,ele){if(!obj[ele.data.channel]){// eslint-disable-next-line no-param-reassign\nobj[ele.data.channel]={users:ele.data.users,name:ele.data.name,channel:ele.data.channel,messages:ele.messages};}return obj;},{});var videoStates=channelData.reduce(function(obj,ele){// eslint-disable-next-line no-param-reassign\nobj[ele.data.channel]={url:'5mGuCdlCcNM',played:false,paused:true};return obj;},{});setState(function(prev){return _objectSpread({},prev,{channelStates:channelStates,videoStates:videoStates,currentChannel:Object.keys(channelStates)[0]});});});}socket=io(\"\".concat(serverURL,\"/\"));socket.on('connect',function(){// from servers\nsocket.on('server message',function(data){console.log(data);});socket.emit('join channels',{authorization:state.authorization},function(data){console.log(data);});});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){if(!state.currentChannelLoaded){setState(function(prev){return _objectSpread({},prev,{currentChannelLoaded:true});});}else{setState(function(prev){return _objectSpread({},prev,{loaded:true});});}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[state.currentChannel]);useEffect(function(){mapService.getLocation(updateLocation);getLocation();socket.on('new message',function(data){var channelID=data.channelID,newMessageObj=data.newMessageObj;if(channelID&&newMessageObj){setState(function(prev){return _objectSpread({},prev,{channelStates:_objectSpread({},prev.channelStates,_defineProperty({},channelID,_objectSpread({},prev.channelStates[channelID],{messages:prev.channelStates[channelID].messages.concat(newMessageObj)})))});});}});socket.on('user status',function(_ref3){var userStatus=_ref3.userStatus;var channel=userStatus.channel,users=userStatus.users;console.log(users,channel);setState(function(prev){return _objectSpread({},prev,{users:_objectSpread({},prev.users,_defineProperty({},channel,users))});});});socket.on('update location',function(updatedLocations){if(updatedLocations){setState(function(prev){return _objectSpread({},prev,{locations:_objectSpread({},prev.locations,{},updatedLocations)});});}});socket.on('new video state',function(_ref4){var url=_ref4.url,paused=_ref4.paused,played=_ref4.played,channel=_ref4.channel;if(url){setState(function(prev){return _objectSpread({},prev,{videoStates:_objectSpread({},prev.videoStates,_defineProperty({},channel,{url:url,paused:paused,played:played}))});});}});socket.on('new time stamp',function(_ref5){var time=_ref5.time,channel=_ref5.channel;setState(function(prev){return _objectSpread({},prev,{videoStates:_objectSpread({},prev.videoStates,_defineProperty({},channel,_objectSpread({},prev.videoStates[channel],{timeStamp:time})))});});});socket.on('draw',function(_ref6){var user=_ref6.user,channel=_ref6.channel,line=_ref6.line;setState(function(prev){return _objectSpread({},prev,{lines:_objectSpread({},prev.lines,_defineProperty({},channel,_objectSpread({},prev.lines[channel],_defineProperty({},user,{user:user,line:line}))))});});});return function(){socket.off();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);return React.createElement(\"div\",{id:\"main-container\"},React.createElement(\"div\",{id:\"channel-container\"},React.createElement(Router,null,React.createElement(ChannelList,{selectCurrentChannel:selectCurrentChannel,channelIdNamePair:channelIdNamePair,emitJoinChannel:emitJoinChannel,emitCreateChannel:emitCreateChannel,toggleForm:toggleForm}),React.createElement(Switch,null,channelItems),state.loaded&&!state.currentChannel&&React.createElement(NewChannelModal,{emitCreateChannel:emitCreateChannel,emitJoinChannel:emitJoinChannel}),React.createElement(PopupToast,{show:state.newChannelForm,toggleForm:toggleForm,emitCreateChannel:emitCreateChannel,emitJoinChannel:emitJoinChannel}),React.createElement(Redirect,{exact:true,from:\"/home\",to:state.currentChannel?\"/channel/\".concat(state.currentChannel):'/home'}))));};export default Home;","map":{"version":3,"sources":["/home/hei/Documents/finals/JEK/client/src/components/Home/Home.js"],"names":["React","useEffect","BrowserRouter","Router","Switch","Route","Redirect","io","serverURL","channelService","mapService","NewChannelModal","ChannelList","Channel","PopupToast","useYoutube","useChat","socket","Home","state","setState","emitSendMessage","emitJoinChannel","emitCreateChannel","changeVideoState","syncVideo","sendLine","line","lineObj","channel","currentChannel","user","currentUser","prev","lines","emit","updateLocation","location","locationObj","authorization","locations","center","getLocation","navigator","geolocation","watchPosition","channels","Object","keys","channelStates","channelIdNamePair","map","id","name","selectCurrentChannel","toggleForm","s","newChannelForm","channelItems","messages","users","videoStates","getUserData","then","channelData","reduce","obj","ele","data","url","played","paused","on","console","log","currentChannelLoaded","loaded","channelID","newMessageObj","concat","userStatus","updatedLocations","time","timeStamp","off"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n} from 'react-router-dom';\nimport io from 'socket.io-client';\nimport { serverURL } from '../../utils/config';\n\nimport channelService from '../../service/channelService';\nimport mapService from '../../service/mapService';\n\nimport NewChannelModal from './ChannelList/NewChannelModal';\nimport ChannelList from './ChannelList/ChannelList';\nimport Channel from './Channel/Channel';\n\nimport PopupToast from './PopUpToast';\n\nimport { useYoutube } from '../../hooks/useYoutube';\nimport { useChat } from '../../hooks/useChat';\n\nimport './homeStyling.css';\nimport '../../styles.css';\n\nlet socket;\n\nconst Home = ({ state, setState }) => {\n  const {\n    emitSendMessage,\n    emitJoinChannel,\n    emitCreateChannel,\n  } = useChat(state, setState, socket);\n\n  const {\n    changeVideoState,\n    syncVideo,\n  } = useYoutube(state, setState, socket);\n\n  const sendLine = (line) => {\n    const lineObj = {\n      line,\n      channel: state.currentChannel,\n      user: state.currentUser,\n    };\n    setState((prev) => ({\n      ...prev,\n      lines: {\n        ...prev.lines,\n        [state.currentChannel]: {\n          ...prev.lines[state.currentChannel],\n          [state.currentUser]: {\n            user: state.currentUser,\n            line,\n          },\n        },\n      },\n    }));\n    socket.emit('draw', lineObj);\n  };\n\n  const updateLocation = (location) => {\n    const locationObj = {\n      location,\n      authorization: state.authorization,\n    };\n    socket.emit('update location', locationObj, (locations) => {\n      setState((prev) => ({\n        ...prev,\n        locations,\n        center: location,\n      }));\n    });\n  };\n\n  const getLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.watchPosition(() => {\n        mapService.getLocation(updateLocation);\n      });\n    }\n  };\n\n  const channels = Object.keys(state.channelStates);\n  const channelIdNamePair = channels.map((id) => ({ id, name: state.channelStates[id].name }));\n\n  const selectCurrentChannel = (channel) => {\n    setState((prev) => ({ ...prev, currentChannel: channel }));\n  };\n\n  const toggleForm = (s) => {\n    setState((prev) => ({ ...prev, newChannelForm: s }));\n  };\n\n  const channelItems = channels.map((id) => {\n    const { name, messages, users } = state.channelStates[id];\n    return (\n      <Route\n        path={`/channel/${id}`}\n        key={`${id}`}\n      >\n        <Channel\n          channel={id}\n          name={name}\n          messages={messages}\n          userStatus={state.users[id]}\n          userList={users}\n          emitSendMessage={emitSendMessage}\n          locations={state.locations[id]}\n          center={state.center}\n          currentUser={state.currentUser}\n          videoStates={state.videoStates}\n          changeVideoState={changeVideoState}\n          syncVideo={syncVideo}\n          sendLine={sendLine}\n          lines={state.lines[id]}\n        />\n      </Route>\n    );\n  });\n\n  // handle initial state\n  useEffect(() => {\n    // grab all channel data, messages\n    if (state.authorization) {\n      channelService\n        .getUserData()\n        .then(({ channelData }) => {\n          const channelStates = channelData.reduce((obj, ele) => {\n            if (!obj[ele.data.channel]) {\n              // eslint-disable-next-line no-param-reassign\n              obj[ele.data.channel] = {\n                users: ele.data.users,\n                name: ele.data.name,\n                channel: ele.data.channel,\n                messages: ele.messages,\n              };\n            }\n            return obj;\n          }, {});\n          const videoStates = channelData.reduce((obj, ele) => {\n            // eslint-disable-next-line no-param-reassign\n            obj[ele.data.channel] = {\n              url: '5mGuCdlCcNM',\n              played: false,\n              paused: true,\n            };\n            return obj;\n          }, {});\n          setState((prev) => ({\n            ...prev,\n            channelStates,\n            videoStates,\n            currentChannel: Object.keys(channelStates)[0],\n          }));\n        });\n    }\n    socket = io(`${serverURL}/`);\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', (data) => {\n        console.log(data);\n      });\n      socket.emit('join channels', { authorization: state.authorization }, (data) => {\n        console.log(data);\n      });\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!state.currentChannelLoaded) {\n      setState((prev) => ({ ...prev, currentChannelLoaded: true }));\n    } else {\n      setState((prev) => ({ ...prev, loaded: true }));\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.currentChannel]);\n\n  useEffect(() => {\n    mapService.getLocation(updateLocation);\n    getLocation();\n\n    socket.on('new message', (data) => {\n      const { channelID, newMessageObj } = data;\n      if (channelID && newMessageObj) {\n        setState((prev) => (\n          {\n            ...prev,\n            channelStates: {\n              ...prev.channelStates,\n              [channelID]: {\n                ...prev.channelStates[channelID],\n                messages: prev.channelStates[channelID].messages.concat(newMessageObj),\n              },\n            },\n          }));\n      }\n    });\n\n    socket.on('user status', ({ userStatus }) => {\n      const { channel, users } = userStatus;\n      console.log(users, channel)\n      setState((prev) => ({\n        ...prev,\n        users: {\n          ...prev.users,\n          [channel]: users,\n        },\n      }));\n    });\n\n    socket.on('update location', (updatedLocations) => {\n      if (updatedLocations) {\n        setState((prev) => ({\n          ...prev,\n          locations: {\n            ...prev.locations,\n            ...updatedLocations,\n          },\n        }));\n      }\n    });\n\n    socket.on('new video state', ({\n      url, paused, played, channel,\n    }) => {\n      if (url) {\n        setState((prev) => (\n          {\n            ...prev,\n            videoStates: {\n              ...prev.videoStates,\n              [channel]: {\n                url,\n                paused,\n                played,\n              },\n            },\n          }\n        ));\n      }\n    });\n\n    socket.on('new time stamp', ({\n      time, channel,\n    }) => {\n      setState((prev) => (\n        {\n          ...prev,\n          videoStates: {\n            ...prev.videoStates,\n            [channel]: { ...prev.videoStates[channel], timeStamp: time },\n          },\n        }\n      ));\n    });\n\n    socket.on('draw', ({ user, channel, line }) => {\n      setState((prev) => ({\n        ...prev,\n        lines: {\n          ...prev.lines,\n          [channel]: {\n            ...prev.lines[channel],\n            [user]: {\n              user,\n              line,\n            },\n          },\n        },\n      }));\n    });\n\n    return () => {\n      socket.off();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div id=\"main-container\">\n      <div id=\"channel-container\">\n        <Router>\n          <ChannelList\n            selectCurrentChannel={selectCurrentChannel}\n            channelIdNamePair={channelIdNamePair}\n            emitJoinChannel={emitJoinChannel}\n            emitCreateChannel={emitCreateChannel}\n            toggleForm={toggleForm}\n          />\n          <Switch>\n            {channelItems}\n          </Switch>\n          {state.loaded && !state.currentChannel && (\n          <NewChannelModal\n            emitCreateChannel={emitCreateChannel}\n            emitJoinChannel={emitJoinChannel}\n          />\n          )}\n          <PopupToast\n            show={state.newChannelForm}\n            toggleForm={toggleForm}\n            emitCreateChannel={emitCreateChannel}\n            emitJoinChannel={emitJoinChannel}\n          />\n          <Redirect exact from=\"/home\" to={state.currentChannel ? `/channel/${state.currentChannel}` : '/home'} />\n        </Router>\n      </div>\n    </div>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}